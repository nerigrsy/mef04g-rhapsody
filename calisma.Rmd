---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
plot(cars)
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

```{r}
install.packages("jsonlite")
```
```{r}
library(jsonlite)
library(dplyr)
library(lubridate)
library(ggplot2)
library(shiny)
```
```{r}
data<-fromJSON(isbike_20201118)
```

```{r}
data
```


```{r}
data <- data$dataList
```

guid -> istasyona ait unique ID
bos -> istasyonda bulunan boş park bilgisi
dolu -> istasyonda bulunan dolu park bilgisi
sonBağlantı -> istasyona son erişim zamanı

```{r}
summary(data)
```
```{r}
tail(data)
```
```{r}
unique(data$adi)
```
```{r}
#İlçelerin koordinat bilgileri kaynağı: https://gist.github.com/abdullahoguk/ee03c26a23dca6eda9c480b4967e77b6
ilceler <- read.csv(file="C:/Users/Emre - PC/Desktop/MEF Assignments/R Exercises/Week 7-9 Group Project/ilce.csv", encoding = "UTF-8")
```

```{r}
head(ilceler)
```

```{r}
ist_ilce <- ilceler %>%
  filter(il_plaka==34)
```

```{r}
ist_ilce
```

```{r}
data2<-data

data2$lat<- as.numeric(data2$lat)
data2$lon <- as.numeric(data2$lon)
data2$bos <- as.numeric(data2$bos)
data2$dolu <- as.numeric(data2$dolu)
```

```{r}
data2$lat[is.na(data2$lat)] <- 0
data2$lon[is.na(data2$lon)] <- 0
```

```{r}
tail(data2, 30)
data2$ilce_adi <- "DİĞER"
```


```{r}
#Koordinat aralığına göre yöntem
for (i in 1:length(data2$guid)){
  for (j in 1:length((ist_ilce$ilce_id))){
    if (((data2$lat[i]<ist_ilce$northeast_lat[j]) & (data2$lat[i]>ist_ilce$southwest_lat[j])) & ((data2$lon[i]<ist_ilce$northeast_lon[j]) & (data2$lon[i]>ist_ilce$southwest_lon[j]))) {
      data2$ilce_adi[i] <- ist_ilce$ilce_adi[j]
    }
    
  }
  }
```


```{r}
#koordinat farkına göre yöntem
for (i in 1:length(data2$guid)){
  if (data2$ilce_adi[i] != "DİĞER"){
    next
  }
  mini <- 5
  for (j in 1:length((ist_ilce$ilce_id))){
    coor <- abs(data2$lat[i] - ist_ilce$lat[j]) * abs(data2$lon[i] - ist_ilce$lon[j])
    if (coor < mini){
      mini<- coor
      data2$ilce_adi[i] <- ist_ilce$ilce_adi[j]
    }
  }
  }
  
```


```{r}
tail(data2)
```

```{r}
data2$kapasite <- data2$bos + data2$dolu
```

```{r}
ggplot(data2, aes(x = ilce_adi)) +
  geom_bar()+
  theme(axis.text.x = element_text(angle=90))
  
```


```{r}
data2 %>%
  group_by(ilce_adi) %>%
  count(ilce_adi)%>%
  arrange(desc(n))
```

```{r}
data2 %>%
  filter(ilce_adi == "ZEYTİNBURNU")
```

```{r}
ggplot(data2, aes(x=lon, y=lat, color=ilce_adi)) +
  geom_point()+
  coord_cartesian(xlim=c(min(ist_ilce$southwest_lon), max(ist_ilce$southwest_lon)), ylim = c(min(ist_ilce$southwest_lat), max(ist_ilce$southwest_lat)))+
  scale_fill_distiller(palette="Blues")+
  labs(title = "Stations on coordinate system of Istanbul",
       x = "Latitude",
       y= "Longitude")

```

